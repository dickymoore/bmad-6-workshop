<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.2</storyId>
    <title>JSON storage service with schema validation</title>
    <status>review</status>
    <generatedAt>2025-12-03</generatedAt>
    <generator>Codex Dev Agent</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-2-json-storage-service-with-schema-validation.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>a validated JSON storage layer for users/bookings</iWant>
    <soThat>corrupt data doesn’t break the app</soThat>
    <tasks><![CDATA[
    - Define zod schemas for users, bookings, backup; validate deskId against desks.json office/floor mapping.
    - Read drops invalid rows with warnings; write atomically updates last-updated; return structured results.
    - Expose helpers and events for UI flows; enforce { ok, error }.
    - Tests for valid load, invalid skip, deskId rejection, last-updated touch, error paths.
    ]]></tasks>
  </story>

  <acceptanceCriteria><![CDATA[
    1) Reading valid users.json/bookings.json loads without errors.
    2) Invalid records are skipped/logged; app still loads.
    3) Every write is atomic and updates last-updated.json with ISO.
    4) DeskId validation checks bookings against desks.json before writes; invalid writes rejected.
    5) Storage functions return structured { ok, error }.
    ]]></acceptanceCriteria>

  <artifacts>
    <docs><![CDATA[
    - docs/epics.md (Epic 1, Story 1.2)
    - docs/architecture.md (data layout, desk validation)
    - docs/sprint-artifacts/tech-spec-epic-1.md (storage contracts)
    - docs/prd.md (FR12–FR15 persistence)
    ]]></docs>
  </artifacts>
</story-context>
